---
dependencies:
  - role: meta/repository
    repository_key: '0xb9316a7bc7917b12'
    repository_url: 'deb http://ppa.launchpad.net/chris-lea/redis-server/ubuntu trusty main'

  - role: package/upstart
    when: redis_server
    upstart_name: redis-server
    upstart_description: 'redis server'
    upstart_exec: '/usr/bin/redis-server -- /etc/redis/redis.conf'
    upstart_pre_start:
      - "mkdir -p {{ redis_server_pidfile_path }}"
      - "chown {{ redis_user }}:{{ redis_group }} {{ redis_server_pidfile_path }}"
    upstart_user: "{{ redis_user }}"
    upstart_group: "{{ redis_group }}"

  - role: meta/monitor
    when: redis_server
    monitor_name: redis-server
    monitor_pidfile: "{{ redis_server_pidfile_path }}"

  - role: meta/logging
    when: redis_server
    logging_name: redis-server 
    logging_files:
      - tags:
          - service
        path: "{{ redis_server_log_path }}"
